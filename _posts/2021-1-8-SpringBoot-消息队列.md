---
title: SpringBoot学习-消息队列
date: 2021-1-8 23:29:53
categories:
- Spring
tags:
- Spring
---

## 1、什么是消息队列？

​     消息（Message）是指在应用之间传送的数据，消息可以非常简单，比如只包含文本字符串，也可以更复杂，可能包含嵌入对象。

​    **消息队列**（Message Queue）是一种应用间的通信方式，消息发送后可以立即返回，有消息系统来确保信息的可靠传递，消息发布者只管把消息发布到MQ中而不管谁来取，消息使用者只管从MQ中取消息而不管谁发布的，这样发布者和使用者都不用知道对方的存在。

## 2、为什么使用消息队列？

### 2.1、解耦

​     传统模式的缺点 ：系统间耦合性太强，系统A在代码中直接调用系统B和系统C的代码，如果将来D系统接入，系统A还需要修改代码。

   中间件模式的的优点：将消息写入消息队列，需要消息的系统自己从消息队列中订阅，从而系统A不需要做任何修改。 

![]({{ site.url }}/assets/img/spring/4.1.png)


### 2.2、异步

 传统模式的缺点：一些非必要的业务逻辑以同步的方式运行，太耗费时间。

 中间件模式的的优点： 将消息写入消息队列，非必要的业务逻辑以异步的方式运行，加快响应速度 。

![]({{ site.url }}/assets/img/spring/4.2.png)


### 2.3、削峰

 传统模式的缺点：并发量大的时候，所有的请求直接怼到数据库，造成数据库连接异常 。

 中间件模式的的优点 ：系统A慢慢的按照数据库能处理的并发量，从消息队列中慢慢拉取消息。在生产中，这个短暂的高峰期积压是允许的。 

![]({{ site.url }}/assets/img/spring/4.3.png)


## 3、消息队列的种类

几种常用的消息队列包括： ActiveMQ、RabbitMQ、RocketMQ、Kafka 、 ZeroMQ 等。

| **消息队列** | **开发语言** | **协议支持**                                                 | **设计模式**                                                 | **持久化支持**           | **事务支持** | **负载均衡支持** | **功能特点**                                                 | **缺点**                                                     |
| ------------ | ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------ | ------------ | ---------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| RabbitMQ     | Erlang       | AMQP，XMPP，SMTP，STOMP                                      | 代理(Broker)模式（消息在发送给客户端时先在中心队列排队）     | 支持持久化到文件         | 不支持       | 支持             | 性能较好；管理界面较丰富；在互联网公司有较大规模的应用；设计的核心是保证消息正确递交（认为消费者是一直处于活动状态去消费消息的），因此设计的比较重，需要记录很多状态 | 虽然产品开源，但Erlang语言应用不够普遍；集群不支持动态扩展   |
| ZeroMQ       | C++          | ZeroMQ是一个并发框架做的socket库（是一个传输层API库），并不是真正的消息队列/消息中间件 | 点对点模式，通过引用ZeroMQ程序库，在应用之间发送消息，任何应用程序节点都可作为一个MQ | 不支持                   | 不支持       | 不支持           | 低延时，高性能，最高每秒43万条消息                           | 非持久性队列，宕机后数据将会丢失                             |
| ActiveMQ     | Java         | OpenWire，Stomp REST，WS Notification，XMPP，AMQP，JMS       | 支持代理模式，也支持点对点模式                               | 支持持久化到文件或数据库 | 支持         | 支持             | 成熟的产品，在很多公司得到应用；有较多的文档；各种协议支持较好，有多种语言的成熟的客户端；完全支持JMS1.1和J2EE 1.4规范 （持久化，XA消息，事务)；支持Spring，可以很容易内嵌到使用Spring的系统里 | 根据其他用户反馈，会出现丢失消息的问题；其重心已放到下一代产品Apollo，目前社区不够活跃，对 5.x 维护较少 |

## 4、参考资料

1、 https://www.cnblogs.com/xiapu5150/p/9927323.html 

2、 https://www.sojson.com/blog/48.html 

3、 https://www.jianshu.com/p/80eefec808e5 



